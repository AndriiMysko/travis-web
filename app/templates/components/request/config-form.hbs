<TravisForm
  @onSubmit={{perform this.triggerBuild}}
  as |form|
>
  <div class="request-configs-fields" data-test-request-config-form='true'>
    <div class="form-elem">
      <RadioButton
        @value="sha"
        @groupValue={{refType}}
        @changed={{action "change" "refType"}}
        @classNames='ref-type'
      >
        Commit
      </RadioButton>
      <RadioButton
        @value='branch'
        @groupValue={{refType}}
        @changed={{action "change" "refType"}}
        @classNames='ref-type'
      >
        Branch
      </RadioButton>
      {{#if (eq refType "sha") }}
        <form.field
          data-test-request-configs-sha="true"
          @placeholder="Specify a Git sha (optional)"
          @value={{this.sha}}
          @showValidationStatusIcons={{false}}
          @onChange={{action "change" "sha"}}
          as |field|
        >
          {{field.input}}
        </form.field>
      {{else}}
        <form.field
          data-test-request-configs-branch="true"
          @classNames="ref-type-branch"
          @placeholder="Select a branch"
          @value={{this.branch}}
          @showValidationStatusIcons={{false}}
          @onChange={{action "change" "branch"}}
          as |field|
        >
          <field.select
            @search={{perform this.searchBranches}}
            as |branch|
          >
            {{branch}}
          </field.select>
        </form.field>
      {{/if}}
    </div>

    <div class="form-elem">
      <form.field
        data-test-request-configs-message="true"
        @classNames="ref-type-sha"
        @value={{this.message}}
        @label="Message"
        @onChange={{action "change" "message"}}
        @placeholder="Overwrite the commit message (optional)"
        as |field|
      >
        {{field.input}}
      </form.field>
    </div>

    {{#each this.configs as |config ix|}}
      <div class="form-elem config-field">
        <div class="request-configs-config-header">
          <h4 class="request-configs-heading">
            Custom build config
            {{#if (gt this.configs.length 1)}}
              #{{incr ix}}
            {{/if}}
          </h4>

          {{#if (eq (incr ix) this.configs.length)}}
            <a
              class="request-configs-button-add"
              {{on 'click' (action 'add' ix)}}
            >
              <SvgImage @name='icon-circle-plus' />
              <EmberTooltip @text="Add another custom build config" />
            </a>

            {{#if (gt ix 0)}}
              <a
                class="request-configs-button-remove"
                {{on 'click' (action 'remove' ix)}}
              >
                <SvgImage @name='icon-circle-minus' />
                <EmberTooltip @text="Remove this custom build config" />
              </a>
            {{/if}}
          {{/if}}

          <div class="config-type {{this.configMode}}">
            <span class="yaml">YAML</span>
            <span class="javascript">JSON</span>
          </div>
        </div>

        <IvyCodemirror
          @value={{config.config}}
          @valueUpdated={{action "changeConfig" ix}}
          @options={{hash
            mode=this.configMode
            lineNumbers=true
            tabSize=2
            indentWithTabs=false
            placeholder="Overwrite build config"
          }}
        />
      </div>

      <div class="form-elem">
        <h4 class="request-configs-heading">
          Merge mode
        </h4>

        <RadioButton
          @value="deep_merge_append"
          @groupValue={{config.mergeMode}}
          @changed={{action "changeMergeMode" ix}}
        >
          Deep Merge &amp; Append
        </RadioButton>
        <RadioButton
          @value="deep_merge_prepend"
          @groupValue={{config.mergeMode}}
          @changed={{action "changeMergeMode" ix}}
        >
          Deep Merge &amp; Prepend
        </RadioButton>
        <RadioButton
          @value="deep_merge"
          @groupValue={{config.mergeMode}}
          @changed={{action "changeMergeMode" ix}}
        >
          Deep Merge
        </RadioButton>
        <RadioButton
          @value="merge"
          @groupValue={{config.mergeMode}}
          @changed={{action "changeMergeMode" ix}}
        >
          Merge
        </RadioButton>
        <RadioButton
          @value="replace"
          @groupValue={{config.mergeMode}}
          @changed={{action "changeMergeMode" ix}}
        >
          Replace
        </RadioButton>

        <ExternalLinkTo class="hint" href="{{config-get 'urls.triggerBuildMergeModes'}}">
          <SvgImage @name='icon-help' @class='icon-help' />
        </ExternalLinkTo>
      </div>
    {{/each}}
  </div>
</TravisForm>
